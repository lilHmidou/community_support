{% extends 'base.html.twig' %}

{% block title %}
    Solidarity
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/solidarity.css') }}">
{% endblock %}

{% block body %}

    <div class="container">
        <br><br>
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="title1">Rejoignez le Mouvement de Solidarité
                </h1><br>
                <p class="text1">La solidarité prend vie à travers nos actions. Découvrez et participez à nos événements dédiés à la construction d'un monde meilleur.</p><br>
                <a href="{{ path('solidarity_form') }}">
                    <button class="purple">JE POSTE UN ÉVÉNEMENT</button>
                </a>
            </div>
            <div class="col-md-6 d-flex align-items-center justify-content-center">
                <br>
                <img src="{{ asset ('images/solidarity/top1.jpeg') }}" class="img-fluid" alt="Image" width="500" height="200">
            </div>
        </div>
        <br><br>
    </div>
    <div class="contain">
        <br><br>
        <p class="blue">ÉVÉNEMENTS</p>
        <h3>Nos Événements</h3>
        <br>
        <div class="table-container1">
            {% for event in events %}
            <div class="col">
                {% if event.category == "alimentaire" %}
                    <img src="{{ asset ('images/solidarity/sol.jpeg') }}" class="image" alt="Image">
                    <p class="date-creat"></p>
                {% else %}
                    {% if event.category == "communautaire" %}
                        <img src="{{ asset ('images/solidarity/sol3.jpeg') }}" class="image" alt="Image">
                        <p class="date-creat"></p>
                    {% else %}
                        {% if event.category == "environnemental" %}
                            <img src="{{ asset ('images/solidarity/sol1.jpeg') }}" class="image" alt="Image">
                            <p class="date-creat"></p>
                        {% else %}
                            {% if event.category == "sensibilisation" %}
                                <img src="{{ asset ('images/solidarity/sol2.jpeg') }}" class="image" alt="Image">
                                <p class="date-creat"></p>
                            {% else %}
                                <img src="{{ asset ('images/solidarity/solidarite.jpeg') }}" class="image" alt="Image">
                                <p class="date-creat"></p>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
                <br>
                <button class="like-button{{ likedStates[event.id] ? ' liked' : '' }}" onclick="toggleLike(this)" data-post-id="{{ event.id }}">
                    <svg class="heart-icon" viewBox="0 0 24 24">
                        <path fill="{{ likedStates[event.id] ? 'red' : 'black' }}" d="M12,21.35l-1.45-1.32C5.4,15.36,2,12.28,2,8.5C2,5.42,4.42,3,7.5,3c1.74,0,3.41,0.81,4.5,2.09C13.09,3.81,14.76,3,16.5,3C19.58,3,22,5.42,22,8.5C22,12.28,18.6,15.36,13.45,19.03L12,20.35V21.35z"></path>
                    </svg>
                </button>
                <span class="likes-count">Likes: {{ event.like }}</span>

                <p class="title-event">{{ event.title }}</p>
                <p class="desc-event"> {{ event.description }}</p>
                <div class="button-container">
                    <button class="purple">JE PARTICIPE</button>
                    <button class="explore">CONTACTER L'ORGANISATEUR</button>
                </div>
                <br>
                <p class="date-creat">Posté le {{ event.createdAtP|date('Y-m-d') }} à {{ event.createdAtP|date('H:i:s') }}</p>
            </div>
            {% endfor %}
        </div>
    </div>


    {% block javascripts %}
        <script>
            // Initialiser l'état de like pour chaque bouton
            const likedStates = {{ likedStates|json_encode|raw }};

            document.addEventListener('DOMContentLoaded', function() {
                // Ajouter un écouteur d'événement à tous les boutons de like
                document.querySelectorAll('.like-button').forEach(button => {
                    const postId = button.getAttribute('data-post-id');
                    // Initialiser l'état du bouton de like en fonction de likedStates
                    button.classList.toggle('liked', likedStates[postId]);

                    button.addEventListener('click', () => {
                        toggleLike(button);

                        if (likedStates[postId]) {
                            // Si le post est déjà liké, supprimer le like
                            fetch(`/remove_like/${postId}`)
                                .then(response => response.json())
                                .then(data => {
                                    // Mettre à jour le nombre de likes affiché
                                    const likesCountElement = button.nextElementSibling;
                                    likesCountElement.textContent = `Likes: ${data.likes}`;
                                    // Mettre à jour l'état de like dans likedStates
                                    likedStates[postId] = false;
                                })
                                .catch(error => console.error('Erreur lors de la demande de like:', error));
                        } else {
                            // Sinon, ajouter un like
                            fetch(`/add_like/${postId}`)
                                .then(response => response.json())
                                .then(data => {
                                    // Mettre à jour le nombre de likes affiché
                                    const likesCountElement = button.nextElementSibling;
                                    likesCountElement.textContent = `Likes: ${data.likes}`;
                                    // Mettre à jour l'état de like dans likedStates
                                    likedStates[postId] = true;
                                })
                                .catch(error => console.error('Erreur lors de la demande de like:', error));
                        }
                    });
                });

                // Fonction pour basculer l'état de like
                function toggleLike(button) {
                    button.classList.toggle('liked');
                }
            });
        </script>
    {% endblock %}



{% endblock %}